<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="http://localhost:1337/public/stylesheets/LoginSheet.css" />
    <title>Book Search</title>
</head>
<body style=" width:100%;">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary" style="position:fixed; width:100%">
        <a class="navbar-brand" href="#">Mandarin</a>
        <div class="navbar-collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Librarian Management</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
            </ul>
            <a class="text-white mx-2" href="#" id="username">Disabled</a>
            <button class="btn btn-light my-0">Log out</button>
        </div>
    </nav>

    <div style="display:flex ;height:100vh; padding-top:55px">
        <div style="width:15%">
            <ul class="nav flex-column nav-pills bg-dark pt-3 px-2" style="height:100%">
                <li id="viewLibrarian" class="nav-item">
                    <a class="nav-link active" href="#viewLibrarianPage" data-toggle="pill">View Librarian</a>
                </li>
                <li id="registerLibrarian" class="nav-item">
                    <a class="nav-link" href="#registerLibrarianTab" data-toggle="pill">Register Librarian </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
            </ul>
        </div>


        <div class="tab-content" id="pills-tabContent" style="width:85% ;display:flex; justify-content:center; padding-top:30px;  flex-wrap:wrap;height:100%; overflow:scroll">
            <div class="tab-pane fade show active" id="viewLibrarianPage">
                <div class="card" style="height:220px; width:800px; margin-bottom:30px">
                    <div class="card-header  bg-primary text-white font-weight-bold">
                        Search Librarian
                    </div>
                    <div class="card-body">
                        <div>
                            <div class="form-group">
                                <label for="librarianName">Librarian Name</label>
                                <input type="text" class="form-control" id="librarianName">
                            </div>
                            <button class="btn btn-primary" style="width:100%" id="searchLibrarian">Submit</button>
                        </div>
                    </div>
                </div>

                <div class="card" style="height:auto; width:800px">
                    <div class="card-header  bg-primary text-white font-weight-bold">
                        Librarians
                    </div>
                    <div class="py-3 px-4">
                        <ul class="list-group">
                            <li class="list-group-item list-group-item-action">
                                <h5 class="mb-1">Librarian 1</h5>
                                <p class="mb-1">Info.</p>
                                <small>Click to edit</small>
                            </li>

                            <li class="list-group-item list-group-item-action">
                                <h5 class="mb-1">Librarian 2</h5>
                                <p class="mb-1">Info.</p>
                                <small>Click to edit</small>
                            </li>

                            <li class="list-group-item list-group-item-action">
                                <h5 class="mb-1">Librarian 3</h5>
                                <p class="mb-1">Info.</p>
                                <small>Click to edit</small>
                            </li>

                            <li class="list-group-item list-group-item-action">
                                <h5 class="mb-1">Librarian 4</h5>
                                <p class="mb-1">Info.</p>
                                <small>Click to edit</small>
                            </li>

                            <li class="list-group-item list-group-item-action">
                                <h5 class="mb-1">Librarian 5</h5>
                                <p class="mb-1">Info.</p>
                                <small>Click to edit</small>
                            </li>

                            <li class="list-group-item list-group-item-action">
                                <h5 class="mb-1">Librarian 6</h5>
                                <p class="mb-1">Info.</p>
                                <small>Click to edit</small>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="registerLibrarianTab">
                <div class="container">
                    <div class="card">
                        <div class="card-header  bg-primary text-white font-weight-bold">
                            Register Librarian
                        </div>
                        <div class="card-body login_card_bd">
                            <div action="/addLibrarian" method="post">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">User name</label>
                                    <input type="text" class="form-control" name="account" id="add_account" required>
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputPassword1">Password</label>
                                    <input type="password" class="form-control" name="pwd" id="add_pwd" required>
                                </div>
                                <div class="form-group" style="display:flex; justify-content:center; padding-top:30px">
                                    <button class="btn btn-primary" id="RegisterSubmit">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="exampleModal" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit Librarain</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label class="col-form-label">Name:</label>
                            <input type="text" class="form-control" id="edit-modal-name">
                        </div>
                        <div class="form-group">
                            <label class="col-form-label">Password:</label>
                            <input type="text" class="form-control" id="edit-modal-password">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="width:80px; height:40px">Cancel</button>
                    <button type="button" class="btn btn-primary" id="editSubmit" style="width:80px; height:40px">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>

        /*spinner
         * <div class="spinner-border" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            */


        //Get username
        $(function () {
            $.get("/admin/username", function (data) {
                $("#username").html(data.userName);
            })
        });

        var curName;

        $("#searchLibrarian").click(function () {
            $.get("/admin/searchLibrarian", { key: $("#librarianName").val() }, function (data) {
                if (data.code == 1) alert("Librarian not find");
                else if (data.code == 0) {
                    curName = data.name;
                    $("#exampleModal").modal('toggle');
                    $("#edit-modal-name").val(data.name);
                    $("#edit-modal-password").val(data.password);
                }
            });
        });

        $('#editSubmit').click(function () {
            this.innerHTML = '<div class="spinner-border" style="width:25px; height:25px" role="status"><span class="sr-only">Loading...</span></div>';
            $.post("/admin/updateLibrarian", { curName: curName, newName: $("#edit-modal-name").val(), newPassword: $("#edit-modal-password").val() }, function (data) {
                $('#editSubmit').html("Submit");
                $("#exampleModal").modal('toggle');
                if (data.code == 0) {
                    alert("Edit success!");
                } else {
                    alert("Edit failed！")
                }
            })
        })

        $('#RegisterSubmit').click(function () {
            this.innerHTML = '<div class="spinner-border" style="width:25px; height:25px" role="status"><span class="sr-only">Loading...</span></div>';
            $.post("/admin//addLibrarian", { name: $("#add_account").val(), password: $("#add_pwd").val() }, function (data) {
                $('#RegisterSubmit').html("Submit");
                if (data.code == 0) {
                    alert("Register success!");
                } else if (data.code == 2) {
                    alert("Duplicated Name！");
                } else alert("Register failed");
            })
        })
        
    </script>
</body>
</html>